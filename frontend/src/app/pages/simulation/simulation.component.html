<div class="simulation-container">
 <div>
    <div class="panel-header">
      <span class="panel-title">Simulation</span>
      <span class="step-badge">Step 4 of 4</span>
    </div>
  <!-- Start Button -->
  <div class="card-row">
    <div class="card-full">
      <button class="start-btn" (click)="startSimulation()" [disabled]="simulationStarted">
        {{ simulationStarted ? 'Streaming...' : 'Start Simulation' }}
      </button>
    </div>
  </div>

  <!-- Stats Panel in Card -->
  <div class="card-row">
    <div class="card">
      <h3>Live Statistics</h3>
      <div class="stats-grid">
        <div class="stat-item"><strong>Total:</strong> {{ total }}</div>
        <div class="stat-item"><strong>Pass:</strong> {{ pass }}</div>
        <div class="stat-item"><strong>Fail:</strong> {{ fail }}</div>
        <div class="stat-item"><strong>Avg. Confidence:</strong> {{ avgConfidence | number: '1.2-2' }}%</div>
      </div>
    </div>
  </div>

  <!-- Charts in Card -->
  <div class="card-row">
    <!-- Line Chart Card -->
    <div class="card chart-card">
      <h3>Pass Percentage (Quality Score)</h3>
      <canvas baseChart
              [datasets]="[{ data: qualityScoreData, label: 'Pass %' }]"
              [labels]="qualityScoreLabels"
              [options]="{ responsive: true }"
              [legend]="true"
              [type]="'line'">
      </canvas>
    </div>

    <!-- Doughnut Chart Card -->
    <div class="card chart-card">
      <h3>Avg Confidence Score</h3>
      <canvas baseChart
              [data]="doughnutChartData"
              [labels]="['Confidence', 'Remaining']"
              [type]="'doughnut'"
              [options]="{ responsive: true }">
      </canvas>
    </div>
  </div>

  <!-- Table in Card -->
  <div class="card-row">
    <div class="card">
      <h3>Prediction Stream</h3>
      <table class="prediction-table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Sample ID</th>
            <th>Prediction</th>
            <th>Confidence</th>
            <th>Label</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let msg of messages">
            <td>{{ msg.timestamp }}</td>
            <td>{{ msg.sample_id }}</td>
            <td>{{ msg.prediction }}</td>
            <td>{{ msg.confidence | number: '1.2-4' }}</td>
            <td>{{ msg.label }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>